{% extends "base.html" %}

{% block title %}Meeting {{ meeting.id }} - ZoomClone{% endblock %}

{% block head %}
<!-- Socket.IO -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
<!-- Emoji Picker -->
<script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
{% endblock %}

{% block content %}
<div class="meeting-room">
    <!-- Meeting Header -->
    <div class="meeting-header">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center">
                <div class="meeting-info">
                    <h5 class="mb-1">Meeting ID: {{ meeting.id }}</h5>
                    <div class="meeting-timer">
                        <i class="fas fa-clock me-1"></i>
                        <span id="timer">00:00:00</span>
                    </div>
                </div>
                <div class="meeting-actions">
                    <button class="btn btn-danger" onclick="leaveMeeting()">
                        <i class="fas fa-sign-out-alt me-1"></i>Leave Meeting
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Meeting Area -->
    <div class="meeting-content">
        <div class="container-fluid h-100">
            <div class="row h-100">
                <!-- Video Area -->
                <div class="col-lg-9 col-md-8">
                    <div class="video-container">
                        <!-- Main Video -->
                        <div class="main-video">
                            <div class="video-placeholder">
                                <i class="fas fa-video fa-3x text-muted"></i>
                                <p class="mt-3 text-muted">Video will appear here</p>
                                <small class="text-muted">WebRTC integration ready</small>
                            </div>
                            <div class="video-overlay">
                                <span class="participant-name">{{ user.name }} (You)</span>
                            </div>
                        </div>

                        <!-- Participant Videos -->
                        <div class="participant-videos" id="participantVideos">
                            <!-- Participant videos will be dynamically added here -->
                        </div>

                        <!-- Meeting Controls -->
                        <div class="meeting-controls">
                            <div class="control-group">
                                <button class="control-btn" id="micBtn" onclick="toggleMicrophone()">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <button class="control-btn" id="cameraBtn" onclick="toggleCamera()">
                                    <i class="fas fa-video"></i>
                                </button>
                                <button class="control-btn" onclick="shareScreen()">
                                    <i class="fas fa-desktop"></i>
                                </button>
                                <button class="control-btn" onclick="toggleChat()">
                                    <i class="fas fa-comment"></i>
                                </button>
                                <button class="control-btn" onclick="showParticipants()">
                                    <i class="fas fa-users"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat & Participants Sidebar -->
                <div class="col-lg-3 col-md-4">
                    <div class="sidebar">
                        <!-- Chat Section -->
                        <div class="chat-section" id="chatSection">
                            <div class="chat-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-comment me-2"></i>Chat
                                </h6>
                                <button class="btn btn-sm" onclick="showReactionPicker()">
                                    <i class="fas fa-smile"></i>
                                </button>
                            </div>
                            
                            <div class="chat-messages" id="chatMessages">
                                <!-- Chat messages will appear here -->
                            </div>
                            
                            <div class="chat-input">
                                <div class="input-group">
                                    <button class="btn btn-outline-secondary" type="button" onclick="toggleEmojiPicker()">
                                        <i class="fas fa-smile"></i>
                                    </button>
                                    <input type="text" class="form-control" id="messageInput" 
                                           placeholder="Type a message..." maxlength="500">
                                    <button class="btn btn-primary" onclick="sendMessage()">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                                <div class="emoji-picker-container" id="emojiPickerContainer" style="display: none;">
                                    <div class="emoji-grid">
                                        <span class="emoji-item" onclick="insertEmoji('üòÄ')">üòÄ</span>
                                        <span class="emoji-item" onclick="insertEmoji('üòÇ')">üòÇ</span>
                                        <span class="emoji-item" onclick="insertEmoji('üòç')">üòç</span>
                                        <span class="emoji-item" onclick="insertEmoji('ü§î')">ü§î</span>
                                        <span class="emoji-item" onclick="insertEmoji('üò≠')">üò≠</span>
                                        <span class="emoji-item" onclick="insertEmoji('üòé')">üòé</span>
                                        <span class="emoji-item" onclick="insertEmoji('üëç')">üëç</span>
                                        <span class="emoji-item" onclick="insertEmoji('üëé')">üëé</span>
                                        <span class="emoji-item" onclick="insertEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</span>
                                        <span class="emoji-item" onclick="insertEmoji('üî•')">üî•</span>
                                        <span class="emoji-item" onclick="insertEmoji('üíØ')">üíØ</span>
                                        <span class="emoji-item" onclick="insertEmoji('üéâ')">üéâ</span>
                                        <span class="emoji-item" onclick="insertEmoji('üëè')">üëè</span>
                                        <span class="emoji-item" onclick="insertEmoji('üí™')">üí™</span>
                                        <span class="emoji-item" onclick="insertEmoji('üôè')">üôè</span>
                                        <span class="emoji-item" onclick="insertEmoji('‚ú®')">‚ú®</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Participants Section -->
                        <div class="participants-section" id="participantsSection">
                            <div class="participants-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-users me-2"></i>
                                    Participants (<span id="participantCount">1</span>)
                                </h6>
                            </div>
                            
                            <div class="participants-list" id="participantsList">
                                <div class="participant-item">
                                    <div class="participant-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="participant-info">
                                        <span class="participant-name">{{ user.name }} (You)</span>
                                        <div class="participant-status">
                                            <i class="fas fa-microphone text-success"></i>
                                            <i class="fas fa-video text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Reactions -->
    <div class="floating-reactions" id="floatingReactions"></div>
</div>

<!-- Leave Meeting Confirmation Modal -->
<div class="modal fade" id="leaveMeetingModal" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title">Leave Meeting</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to leave this meeting?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger btn-sm" onclick="confirmLeaveMeeting()">Leave</button>
            </div>
        </div>
    </div>
</div>

<script>
// Meeting configuration
const MEETING_CONFIG = {
    meetingId: '{{ meeting.id }}',
    userId: '{{ user.id }}',
    userName: '{{ user.name }}'
};
</script>

<script src="{{ url_for('static', filename='meeting.js') }}"></script>
{% endblock %}
